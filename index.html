<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tea Station - Order Menu</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Georgia', serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(45deg, #2c3e50, #3498db);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1em;
        }

        .main-content {
            padding: 30px;
        }

        .section {
            margin-bottom: 40px;
        }

        .section h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.8em;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }

        .menu-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .menu-item {
            border: 2px solid #ecf0f1;
            border-radius: 10px;
            padding: 20px;
            transition: all 0.3s ease;
        }

        .menu-item:hover {
            border-color: #3498db;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .menu-item.sold-out {
            opacity: 0.6;
            background: #f8f9fa;
        }

        .item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .item-name {
            font-weight: bold;
            font-size: 1.2em;
            color: #2c3e50;
        }

        .item-price {
            color: #27ae60;
            font-weight: bold;
        }

        .item-description {
            color: #7f8c8d;
            margin-bottom: 15px;
            line-height: 1.4;
        }

        .item-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .stock-info {
            font-size: 0.9em;
            color: #7f8c8d;
        }

        .sold-out-label {
            color: #e74c3c;
            font-weight: bold;
        }

        .quantity-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .qty-btn {
            background: #3498db;
            color: white;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            font-weight: bold;
        }

        .qty-btn:hover {
            background: #2980b9;
        }

        .qty-btn:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
        }

        .quantity {
            font-weight: bold;
            min-width: 20px;
            text-align: center;
        }

        .cart-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-top: 30px;
        }

        .cart-items {
            margin-bottom: 20px;
        }

        .cart-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #dee2e6;
        }

        .cart-total {
            font-size: 1.3em;
            font-weight: bold;
            color: #2c3e50;
            text-align: right;
            margin-bottom: 20px;
        }

        .order-form {
            display: grid;
            gap: 15px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            margin-bottom: 5px;
            font-weight: bold;
            color: #2c3e50;
        }

        .form-group input {
            padding: 10px;
            border: 2px solid #ecf0f1;
            border-radius: 5px;
            font-size: 1em;
        }

        .form-group input:focus {
            outline: none;
            border-color: #3498db;
        }

        .submit-btn {
            background: #27ae60;
            color: white;
            border: none;
            padding: 15px;
            border-radius: 5px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .submit-btn:hover {
            background: #219a52;
        }

        .submit-btn:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
        }



        .message {
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
            text-align: center;
            font-weight: bold;
        }

        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .empty-cart {
            text-align: center;
            color: #7f8c8d;
            font-style: italic;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #7f8c8d;
        }

        /* ===== FIND YOUR TEA-MATE QUIZ ===== */
        @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Lora:wght@400;600&display=swap');

        .teammate-callout {
            background: linear-gradient(135deg, #1a0a0e 0%, #2d1118 40%, #1a0a1e 100%);
            margin: 0;
            padding: 24px 30px;
            position: relative;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.4s ease;
        }
        .teammate-callout::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: radial-gradient(ellipse at 20% 50%, rgba(200,50,80,0.15) 0%, transparent 60%),
                        radial-gradient(ellipse at 80% 50%, rgba(200,150,50,0.1) 0%, transparent 60%);
            pointer-events: none;
        }
        .teammate-callout::after {
            content: '';
            position: absolute;
            bottom: 0; left: 0; right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(200,130,100,0.4), transparent);
        }
        .callout-compact {
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: relative;
            z-index: 1;
        }
        .callout-left {
            display: flex;
            align-items: center;
            gap: 14px;
        }
        .callout-heart {
            font-size: 1.6em;
            animation: heartPulse 1.8s ease-in-out infinite;
            filter: drop-shadow(0 0 8px rgba(200,150,80,0.5));
        }
        @keyframes heartPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.15); }
        }
        .callout-text h3 {
            font-family: 'Playfair Display', Georgia, serif;
            font-size: 1.15em;
            color: #e8c4a0;
            font-weight: 700;
            letter-spacing: 0.5px;
            margin-bottom: 2px;
        }
        .callout-text p {
            font-family: 'Lora', Georgia, serif;
            font-size: 0.82em;
            color: rgba(220,180,160,0.7);
            font-style: italic;
        }
        .callout-btn {
            background: linear-gradient(135deg, #8b2240, #a8304e);
            color: #f0d5c0;
            border: 1px solid rgba(200,130,100,0.3);
            padding: 10px 22px;
            border-radius: 30px;
            font-family: 'Playfair Display', Georgia, serif;
            font-size: 0.9em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            letter-spacing: 0.5px;
            white-space: nowrap;
        }
        .callout-btn:hover {
            background: linear-gradient(135deg, #a8304e, #c0405e);
            box-shadow: 0 4px 20px rgba(168,48,78,0.4);
            transform: translateY(-1px);
        }
        .teammate-callout.expanded {
            padding: 30px;
            cursor: default;
        }
        .quiz-container { display: none; position: relative; z-index: 1; }
        .teammate-callout.expanded .callout-compact { display: none; }
        .teammate-callout.expanded .quiz-container { display: block; }

        .quiz-header { text-align: center; margin-bottom: 28px; }
        .quiz-header h2 {
            font-family: 'Playfair Display', Georgia, serif;
            font-size: 1.8em;
            color: #e8c4a0;
            margin-bottom: 6px;
            letter-spacing: 1px;
        }
        .quiz-header p {
            font-family: 'Lora', Georgia, serif;
            color: rgba(220,180,160,0.6);
            font-style: italic;
            font-size: 0.9em;
        }
        .quiz-progress {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 30px;
        }
        .progress-dot {
            width: 10px; height: 10px;
            border-radius: 50%;
            background: rgba(200,130,100,0.2);
            transition: all 0.4s ease;
        }
        .progress-dot.active {
            background: #a8304e;
            box-shadow: 0 0 10px rgba(168,48,78,0.5);
            transform: scale(1.2);
        }
        .progress-dot.completed { background: #e8c4a0; }

        .quiz-step {
            display: none;
            animation: fadeSlideIn 0.5s ease;
        }
        .quiz-step.active { display: block; }
        @keyframes fadeSlideIn {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .quiz-question {
            font-family: 'Playfair Display', Georgia, serif;
            font-size: 1.35em;
            color: #e8c4a0;
            text-align: center;
            margin-bottom: 24px;
            line-height: 1.3;
        }
        .quiz-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            max-width: 500px;
            margin: 0 auto;
        }
        .quiz-option {
            background: rgba(255,255,255,0.04);
            border: 1px solid rgba(200,130,100,0.2);
            border-radius: 12px;
            padding: 16px 14px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        .quiz-option::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: linear-gradient(135deg, rgba(168,48,78,0.3), rgba(200,130,100,0.1));
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        .quiz-option:hover::before { opacity: 1; }
        .quiz-option:hover {
            border-color: rgba(200,130,100,0.5);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }
        .quiz-option.selected {
            border-color: #a8304e;
            background: rgba(168,48,78,0.15);
        }
        .quiz-option.selected::before { opacity: 1; }
        .option-emoji {
            font-size: 1.8em;
            display: block;
            margin-bottom: 8px;
            position: relative;
            z-index: 1;
        }
        .option-label {
            font-family: 'Lora', Georgia, serif;
            font-size: 0.88em;
            color: #ddb89a;
            position: relative;
            z-index: 1;
            line-height: 1.3;
        }
        .quiz-close {
            position: absolute;
            top: 14px; right: 18px;
            background: none;
            border: none;
            color: rgba(220,180,160,0.4);
            font-size: 1.4em;
            cursor: pointer;
            z-index: 2;
            transition: color 0.3s;
            line-height: 1;
        }
        .quiz-close:hover { color: rgba(220,180,160,0.8); }

        /* Reveal / Result */
        .quiz-reveal { display: none; text-align: center; animation: fadeSlideIn 0.6s ease; }
        .quiz-reveal.active { display: block; }
        .reveal-curtain { animation: curtainOpen 1.2s ease forwards; }
        @keyframes curtainOpen {
            0% { opacity: 0; transform: scale(0.8); }
            40% { opacity: 1; transform: scale(1.02); }
            100% { opacity: 1; transform: scale(1); }
        }
        .reveal-sparkles {
            font-size: 1.4em;
            letter-spacing: 4px;
            margin-bottom: 6px;
            animation: sparkle 1.5s ease-in-out infinite;
        }
        @keyframes sparkle { 0%, 100% { opacity: 0.6; } 50% { opacity: 1; } }
        .reveal-title {
            font-family: 'Playfair Display', Georgia, serif;
            font-size: 1.1em;
            color: rgba(220,180,160,0.6);
            text-transform: uppercase;
            letter-spacing: 3px;
            margin-bottom: 16px;
        }
        .match-card {
            background: linear-gradient(135deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02));
            border: 1px solid rgba(200,130,100,0.25);
            border-radius: 16px;
            padding: 28px 24px;
            max-width: 380px;
            margin: 0 auto 20px;
            position: relative;
            overflow: hidden;
        }
        .match-card::before {
            content: '';
            position: absolute;
            top: -1px; left: 20%; right: 20%;
            height: 2px;
            background: linear-gradient(90deg, transparent, #a8304e, transparent);
        }
        .match-image {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            object-fit: cover;
            margin: 0 auto 16px;
            display: block;
            border: 3px solid rgba(200,130,100,0.3);
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }
        .match-image-placeholder {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            margin: 0 auto 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3em;
            background: rgba(168,48,78,0.15);
            border: 3px solid rgba(200,130,100,0.3);
        }
        .match-name {
            font-family: 'Playfair Display', Georgia, serif;
            font-size: 1.9em;
            color: #e8c4a0;
            margin-bottom: 4px;
        }
        .match-origin {
            font-family: 'Lora', Georgia, serif;
            font-size: 0.85em;
            color: rgba(220,180,160,0.5);
            font-style: italic;
            margin-bottom: 16px;
        }
        .compatibility-meter { margin: 16px auto 20px; max-width: 220px; }
        .compat-label {
            font-family: 'Playfair Display', Georgia, serif;
            font-size: 0.8em;
            color: rgba(220,180,160,0.5);
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 8px;
        }
        .compat-bar-bg {
            height: 6px;
            background: rgba(255,255,255,0.08);
            border-radius: 3px;
            overflow: hidden;
            margin-bottom: 6px;
        }
        .compat-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #a8304e, #e8c4a0);
            border-radius: 3px;
            width: 0%;
            transition: width 1.5s cubic-bezier(0.25,0.46,0.45,0.94);
        }
        .compat-percent {
            font-family: 'Playfair Display', Georgia, serif;
            font-size: 1.8em;
            font-weight: 700;
            color: #e8c4a0;
            opacity: 0;
            animation: fadeInPercent 0.5s ease 1.2s forwards;
        }
        @keyframes fadeInPercent { to { opacity: 1; } }
        .match-bio {
            font-family: 'Lora', Georgia, serif;
            font-size: 0.92em;
            color: rgba(220,180,160,0.75);
            line-height: 1.6;
            font-style: italic;
            margin-bottom: 16px;
            padding: 0 8px;
        }
        .match-traits {
            display: flex;
            justify-content: center;
            gap: 8px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }
        .trait-tag {
            background: rgba(168,48,78,0.2);
            border: 1px solid rgba(168,48,78,0.3);
            color: #ddb89a;
            padding: 4px 12px;
            border-radius: 20px;
            font-family: 'Lora', Georgia, serif;
            font-size: 0.75em;
            letter-spacing: 0.5px;
        }
        .match-price {
            font-family: 'Lora', Georgia, serif;
            color: rgba(220,180,160,0.5);
            font-size: 0.9em;
            margin-bottom: 18px;
        }
        .match-actions {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }
        .match-add-btn {
            background: linear-gradient(135deg, #8b2240, #a8304e);
            color: #f0d5c0;
            border: 1px solid rgba(200,130,100,0.3);
            padding: 12px 28px;
            border-radius: 30px;
            font-family: 'Playfair Display', Georgia, serif;
            font-size: 0.95em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            letter-spacing: 0.5px;
        }
        .match-add-btn:hover {
            background: linear-gradient(135deg, #a8304e, #c0405e);
            box-shadow: 0 4px 20px rgba(168,48,78,0.4);
            transform: translateY(-1px);
        }
        .match-retry-btn {
            background: transparent;
            color: rgba(220,180,160,0.5);
            border: 1px solid rgba(200,130,100,0.15);
            padding: 12px 24px;
            border-radius: 30px;
            font-family: 'Lora', Georgia, serif;
            font-size: 0.85em;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .match-retry-btn:hover {
            color: rgba(220,180,160,0.8);
            border-color: rgba(200,130,100,0.35);
        }
        .floating-hearts {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            pointer-events: none;
            overflow: hidden;
            z-index: 0;
        }
        .float-heart {
            position: absolute;
            bottom: -20px;
            font-size: 1em;
            opacity: 0;
            animation: floatUp 3s ease-in forwards;
        }
        @keyframes floatUp {
            0% { opacity: 0; transform: translateY(0) rotate(0deg); }
            20% { opacity: 0.7; }
            100% { opacity: 0; transform: translateY(-300px) rotate(45deg); }
        }
        @media (max-width: 500px) {
            .callout-compact { flex-direction: column; text-align: center; gap: 12px; }
            .callout-left { justify-content: center; }
            .quiz-options { grid-template-columns: 1fr; }
            .quiz-question { font-size: 1.15em; }
            .match-name { font-size: 1.5em; }
        }

    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üçµ Tea Station</h1>
            <p>Welcome to our cozy apartment tea corner!</p>
        </div>

        <div class="main-content">
            <!-- Loading State -->
            <div class="loading" id="loading">
                Loading menu...
            </div>

            <!-- Main Content (hidden until loaded) -->
            <div id="main-app" style="display: none;">

                <!-- Find Your Tea-mate Quiz -->
                <div class="teammate-callout" id="teammate-callout" onclick="startQuiz(event)">
                    <div class="callout-compact">
                        <div class="callout-left">
                            <span class="callout-heart">‚òï</span>
                            <div class="callout-text">
                                <h3>Find Your Tea‚Äëmate</h3>
                                <p>Take the quiz. Meet your new best brew.</p>
                            </div>
                        </div>
                        <button class="callout-btn">Find My Match</button>
                    </div>

                    <div class="quiz-container" id="quiz-container">
                        <button class="quiz-close" onclick="closeQuiz(event)">‚úï</button>
                        <div class="quiz-header">
                            <h2>‚òï Find Your Tea‚Äëmate</h2>
                            <p>Answer 4 questions. Find your perfect brew buddy.</p>
                        </div>

                        <div class="quiz-progress">
                            <div class="progress-dot active" id="dot-0"></div>
                            <div class="progress-dot" id="dot-1"></div>
                            <div class="progress-dot" id="dot-2"></div>
                            <div class="progress-dot" id="dot-3"></div>
                        </div>

                        <!-- Step 1: Caffeine -->
                        <div class="quiz-step active" id="step-0">
                            <div class="quiz-question">What are you looking for tonight?</div>
                            <div class="quiz-options">
                                <div class="quiz-option" onclick="selectOption(event, 0, 'caffeinated')">
                                    <span class="option-emoji">‚ö°</span>
                                    <span class="option-label">Keep me up all night</span>
                                </div>
                                <div class="quiz-option" onclick="selectOption(event, 0, 'decaf')">
                                    <span class="option-emoji">üåô</span>
                                    <span class="option-label">Chill & low‚Äëkey</span>
                                </div>
                                <div class="quiz-option" onclick="selectOption(event, 0, 'adventurous')">
                                    <span class="option-emoji">üé≤</span>
                                    <span class="option-label">Surprise me</span>
                                </div>
                                <div class="quiz-option" onclick="selectOption(event, 0, 'balanced')">
                                    <span class="option-emoji">‚òØÔ∏è</span>
                                    <span class="option-label">Something balanced</span>
                                </div>
                            </div>
                        </div>

                        <!-- Step 2: Mood -->
                        <div class="quiz-step" id="step-1">
                            <div class="quiz-question">Describe your ideal hangout.</div>
                            <div class="quiz-options">
                                <div class="quiz-option" onclick="selectOption(event, 1, 'cozy')">
                                    <span class="option-emoji">üî•</span>
                                    <span class="option-label">Cozy night by the fire</span>
                                </div>
                                <div class="quiz-option" onclick="selectOption(event, 1, 'exotic')">
                                    <span class="option-emoji">‚úàÔ∏è</span>
                                    <span class="option-label">Adventure somewhere exotic</span>
                                </div>
                                <div class="quiz-option" onclick="selectOption(event, 1, 'classy')">
                                    <span class="option-emoji">ü•Ç</span>
                                    <span class="option-label">Something classic & elegant</span>
                                </div>
                                <div class="quiz-option" onclick="selectOption(event, 1, 'peaceful')">
                                    <span class="option-emoji">üåø</span>
                                    <span class="option-label">A peaceful nature walk</span>
                                </div>
                            </div>
                        </div>

                        <!-- Step 3: Flavor -->
                        <div class="quiz-step" id="step-2">
                            <div class="quiz-question">What's your vibe?</div>
                            <div class="quiz-options">
                                <div class="quiz-option" onclick="selectOption(event, 2, 'sweet')">
                                    <span class="option-emoji">üå∏</span>
                                    <span class="option-label">Sweet nothings</span>
                                </div>
                                <div class="quiz-option" onclick="selectOption(event, 2, 'spicy')">
                                    <span class="option-emoji">üå∂Ô∏è</span>
                                    <span class="option-label">Spice things up</span>
                                </div>
                                <div class="quiz-option" onclick="selectOption(event, 2, 'fresh')">
                                    <span class="option-emoji">üçã</span>
                                    <span class="option-label">Keep things fresh</span>
                                </div>
                                <div class="quiz-option" onclick="selectOption(event, 2, 'deep')">
                                    <span class="option-emoji">üåë</span>
                                    <span class="option-label">Deep & mysterious</span>
                                </div>
                            </div>
                        </div>

                        <!-- Step 4: Personality -->
                        <div class="quiz-step" id="step-3">
                            <div class="quiz-question">Who do you gravitate toward at a party?</div>
                            <div class="quiz-options">
                                <div class="quiz-option" onclick="selectOption(event, 3, 'classic')">
                                    <span class="option-emoji">üåπ</span>
                                    <span class="option-label">The dependable one</span>
                                </div>
                                <div class="quiz-option" onclick="selectOption(event, 3, 'bold')">
                                    <span class="option-emoji">üéâ</span>
                                    <span class="option-label">The life of the party</span>
                                </div>
                                <div class="quiz-option" onclick="selectOption(event, 3, 'gentle')">
                                    <span class="option-emoji">üïäÔ∏è</span>
                                    <span class="option-label">The good listener</span>
                                </div>
                                <div class="quiz-option" onclick="selectOption(event, 3, 'unique')">
                                    <span class="option-emoji">ü¶ã</span>
                                    <span class="option-label">The wildcard</span>
                                </div>
                            </div>
                        </div>

                        <!-- Reveal -->
                        <div class="quiz-reveal" id="quiz-reveal">
                            <div class="reveal-curtain">
                                <div class="floating-hearts" id="floating-hearts"></div>
                                <div class="reveal-sparkles">‚ú® ‚òï ‚ú®</div>
                                <div class="reveal-title">Meet Your Tea‚Äëmate</div>
                                <div class="match-card">
                                    <div id="match-image-container"></div>
                                    <div class="match-name" id="match-name"></div>
                                    <div class="match-origin" id="match-origin"></div>
                                    <div class="compatibility-meter">
                                        <div class="compat-label">Compatibility</div>
                                        <div class="compat-bar-bg">
                                            <div class="compat-bar-fill" id="compat-fill"></div>
                                        </div>
                                        <div class="compat-percent" id="compat-percent"></div>
                                    </div>
                                    <div class="match-bio" id="match-bio"></div>
                                    <div class="match-traits" id="match-traits"></div>
                                    <div class="match-price" id="match-price"></div>
                                </div>
                                <div class="match-actions">
                                    <button class="match-add-btn" id="match-add-btn">‚òï Add to Order</button>
                                    <button class="match-retry-btn" onclick="retryQuiz(event)">Try Again</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Caffeinated Tea Menu Section -->
                <div class="section">
                    <h2>‚òï Caffeinated Teas</h2>
                    <div class="menu-grid" id="caffeinated-menu">
                        <!-- Caffeinated tea items will be populated from Firebase -->
                    </div>
                </div>

                <!-- Decaf Tea Menu Section -->
                <div class="section">
                    <h2>üåô Decaf & Herbal Teas</h2>
                    <div class="menu-grid" id="decaf-menu">
                        <!-- Decaf tea items will be populated from Firebase -->
                    </div>
                </div>

                <!-- Accompaniments Section -->
                <div class="section">
                    <h2>üçØ Accompaniments</h2>
                    <div class="menu-grid" id="accompaniments-menu">
                        <!-- Accompaniment items will be populated from Firebase -->
                    </div>
                </div>

                <!-- Cart Section -->
                <div class="cart-section">
                    <h2>Your Order</h2>
                    <div class="cart-items" id="cart-items">
                        <div class="empty-cart">Your cart is empty</div>
                    </div>
                    <div class="cart-total" id="cart-total">Total: $0.00</div>
                    
                    <form class="order-form" id="order-form">
                        <div class="form-group">
                            <label for="customer-name">Your Name:</label>
                            <input type="text" id="customer-name" required>
                        </div>
                        <div class="form-group">
                            <label for="special-requests">Special Requests:</label>
                            <input type="text" id="special-requests" placeholder="Extra honey, no sugar, etc.">
                        </div>
                        <button type="submit" class="submit-btn" id="submit-order" disabled>Place Order</button>
                    </form>
                </div>
            </div>

            <div id="message-area"></div>
        </div>
    </div>

    <!-- Firebase SDKs -->
    <script type="module">
        // Dynamic Firebase imports with fallback
        let initializeApp, getFirestore, collection, doc, getDocs, updateDoc, addDoc, onSnapshot;
        let firebaseLoaded = false;

        try {
            const appModule = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js');
            const fsModule = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js');
            initializeApp = appModule.initializeApp;
            getFirestore = fsModule.getFirestore;
            collection = fsModule.collection;
            doc = fsModule.doc;
            getDocs = fsModule.getDocs;
            updateDoc = fsModule.updateDoc;
            addDoc = fsModule.addDoc;
            onSnapshot = fsModule.onSnapshot;
            firebaseLoaded = true;
        } catch (e) {
            console.warn('Firebase CDN unavailable, using demo data');
        }

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAQW-aZ50AsYzRMkRiCE4VwCzWJaOch1Zw",
            authDomain: "teastation-dd4aa.firebaseapp.com",
            projectId: "teastation-dd4aa",
            storageBucket: "teastation-dd4aa.firebasestorage.app",
            messagingSenderId: "26683066559",
            appId: "1:26683066559:web:af3d6d7fa47a24bf789e0a",
            measurementId: "G-FP0CYH4D9S"
        };

        // Initialize Firebase
        let app, db;
        let inventory = { teas: [], accompaniments: [] };
        let cart = [];

        // Try to initialize Firebase
        try {
            if (firebaseLoaded) {
                app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                await initializeData();
            } else {
                initializeDemoData();
            }
        } catch (error) {
            console.error('Firebase initialization error:', error);
            initializeDemoData();
        }

        // Initialize with real data (for when Firebase isn't configured)
        function initializeDemoData() {
            inventory = {
                teas: [
                    // === CAFFEINATED (17) ===
                    { id: 'chai-tea', name: 'Chai Tea', description: 'Traditional Indian spiced tea blend with warming cardamom, cinnamon, and ginger.', price: 3.25, stock: 8, category: 'tea', type: 'caffeinated', origin: 'Indian' },
                    { id: 'thai-tea', name: 'Thai Tea', description: 'Bold and vibrant Thai black tea with distinctive orange color and sweet flavor.', price: 3.50, stock: 5, category: 'tea', type: 'caffeinated', origin: 'Thai' },
                    { id: 'cinnamon-apple-spice', name: 'Cinnamon Apple Spice', description: 'Cozy American blend with sweet apple pieces and warming cinnamon spices.', price: 3.00, stock: 6, category: 'tea', type: 'caffeinated', origin: 'American' },
                    { id: 'royal-blend', name: 'Royal Blend', description: 'Classic British black tea blend, perfect for a proper afternoon tea.', price: 3.75, stock: 7, category: 'tea', type: 'caffeinated', origin: 'British' },
                    { id: 'earl-gray', name: 'Earl Gray', description: 'Classic British bergamot-scented black tea, bold and aromatic.', price: 3.25, stock: 6, category: 'tea', type: 'caffeinated', origin: 'British' },
                    { id: 'maple-black-tea', name: 'Maple Black Tea', description: 'Rich black tea infused with warm maple sweetness. A comforting autumn-in-a-cup.', price: 3.50, stock: 5, category: 'tea', type: 'caffeinated', origin: 'Canadian' },
                    { id: 'green-tea', name: 'Green Tea', description: 'Pure Japanese green tea with fresh, grassy notes and natural antioxidants.', price: 3.25, stock: 9, category: 'tea', type: 'caffeinated', origin: 'Japanese' },
                    { id: 'maple-green-tea', name: 'Maple Green Tea', description: 'Delicate green tea kissed with light maple sweetness. Fresh and subtly sweet.', price: 3.50, stock: 5, category: 'tea', type: 'caffeinated', origin: 'Japanese-Canadian' },
                    { id: 'high-mountain-dragon-well', name: 'High Mountain Dragon Well', description: 'Premium Chinese green tea with chestnut notes and a smooth, mellow sweetness.', price: 4.50, stock: 4, category: 'tea', type: 'caffeinated', origin: 'Chinese' },
                    { id: 'beautys-waist', name: "Beauty's Waist", description: 'Elegant Chinese green tea with a floral aroma and delicate, graceful flavor.', price: 4.00, stock: 4, category: 'tea', type: 'caffeinated', origin: 'Chinese' },
                    { id: 'candy-cane-green-tea', name: 'Candy Cane Green Tea', description: 'Festive green tea with cool peppermint and a hint of sweetness.', price: 3.25, stock: 5, category: 'tea', type: 'caffeinated', origin: 'American' },
                    { id: 'white-flower-blend', name: 'White Flower Blend', description: 'Fragrant white tea blend with jasmine and chrysanthemum petals.', price: 4.00, stock: 4, category: 'tea', type: 'caffeinated', origin: 'Chinese' },
                    { id: 'oolong-tea', name: 'Oolong Tea', description: 'Traditional oolong with complex, semi-oxidized flavor profile.', price: 4.00, stock: 3, category: 'tea', type: 'caffeinated', origin: 'Chinese' },
                    { id: 'king-of-hearts', name: 'King of Hearts', description: 'Richly aromatic wulong (oolong) tea with deep, toasty character and smooth finish.', price: 4.25, stock: 3, category: 'tea', type: 'caffeinated', origin: 'Chinese' },
                    { id: 'hojicha', name: 'Hojicha', description: 'Roasted Japanese green tea with nutty, caramel-like flavor and lower caffeine.', price: 3.75, stock: 5, category: 'tea', type: 'caffeinated', origin: 'Japanese' },
                    { id: 'right-heart', name: 'Right Heart', description: 'Subtle white tea with gentle, pillowy softness and delicate floral whispers.', price: 4.00, stock: 4, category: 'tea', type: 'caffeinated', origin: 'Chinese' },
                    { id: 'drinking-chocolate', name: 'Drinking Chocolate', description: 'Rich, velvety European-style drinking chocolate. Indulgent and deeply comforting.', price: 4.50, stock: 5, category: 'tea', type: 'caffeinated', origin: 'European' },
                    // === DECAF / HERBAL (13) ===
                    { id: 'chamomile', name: 'Chamomile', description: 'Soothing herbal tea with gentle floral notes, perfect for evening relaxation.', price: 2.75, stock: 8, category: 'tea', type: 'decaf', origin: 'American' },
                    { id: 'butterfly-pea', name: 'Butterfly Pea', description: 'Magical Thai herbal tea that changes color! Naturally blue, turns purple with lemon.', price: 3.50, stock: 4, category: 'tea', type: 'decaf', origin: 'Thai' },
                    { id: 'ssanghwacha', name: 'Ssanghwacha', description: 'Traditional Korean herbal blend with warming properties and earthy flavor.', price: 3.25, stock: 3, category: 'tea', type: 'decaf', origin: 'Korean' },
                    { id: 'lemongrass-pandan', name: 'Lemongrass Pandan', description: 'Exotic Thai blend with citrusy lemongrass and sweet, nutty pandan leaf.', price: 3.25, stock: 5, category: 'tea', type: 'decaf', origin: 'Thai' },
                    { id: 'lemongrass', name: 'Lemongrass', description: 'Pure Thai lemongrass tea with bright, citrusy flavor and digestive benefits.', price: 2.75, stock: 7, category: 'tea', type: 'decaf', origin: 'Thai' },
                    { id: 'corn-silk', name: 'Corn Silk', description: 'Traditional Korean herbal tea known for its subtle sweetness and wellness properties.', price: 2.75, stock: 4, category: 'tea', type: 'decaf', origin: 'Korean' },
                    { id: 'ginger-tea', name: 'Ginger Tea', description: 'Warming, spicy ginger root tea that soothes and invigorates.', price: 2.75, stock: 6, category: 'tea', type: 'decaf', origin: 'Asian' },
                    { id: 'burdock-root', name: 'Burdock Root', description: 'Earthy, grounding herbal tea with a deep, woodsy flavor and cleansing properties.', price: 3.00, stock: 4, category: 'tea', type: 'decaf', origin: 'Japanese' },
                    { id: 'pumpkin-spice-rooibos', name: 'Pumpkin Spice Rooibos', description: 'Caffeine-free South African rooibos with autumn pumpkin spice warmth.', price: 3.25, stock: 5, category: 'tea', type: 'decaf', origin: 'South African' },
                    { id: 'wild-sweet-orange', name: 'Wild Sweet Orange', description: 'Bright and uplifting herbal blend bursting with sweet orange citrus.', price: 3.00, stock: 6, category: 'tea', type: 'decaf', origin: 'American' },
                    { id: 'jujube-tea', name: 'Jujube Tea', description: 'Traditional Korean red date tea with natural sweetness and calming warmth.', price: 3.25, stock: 4, category: 'tea', type: 'decaf', origin: 'Korean' },
                    { id: 'bellflower-root-ginger', name: 'Bellflower Root & Ginger Tea', description: 'Korean herbal blend combining bellflower root with warming ginger.', price: 3.25, stock: 4, category: 'tea', type: 'decaf', origin: 'Korean' },
                    { id: 'maple-herbal-tea', name: 'Maple Herbal Tea', description: 'Caffeine-free herbal blend with sweet maple warmth and gentle spice.', price: 3.00, stock: 5, category: 'tea', type: 'decaf', origin: 'Canadian' }
                ],
                accompaniments: [
                    {
                        id: 'local-honey',
                        name: 'Local Honey',
                        description: 'Sweet wildflower honey from local beekeepers.',
                        price: 0.50,
                        stock: 15,
                        category: 'accompaniment'
                    },
                    {
                        id: 'fresh-lemon',
                        name: 'Fresh Lemon',
                        description: 'Bright citrus wedge - creates color-changing magic with Butterfly Pea!',
                        price: 0.25,
                        stock: 12,
                        category: 'accompaniment'
                    }
                ]
            };
            
            hideLoading();
            renderMenu();
            renderCart();
        }

        // Initialize Firebase data
        async function initializeData() {
            try {
                // Check if we have existing data
                const teaSnapshot = await getDocs(collection(db, 'teas'));
                const accompanimentSnapshot = await getDocs(collection(db, 'accompaniments'));
                
                if (teaSnapshot.empty && accompanimentSnapshot.empty) {
                    // No data exists, create real tea inventory
                    console.log('No existing data found, creating your tea inventory...');
                    await createDemoData();
                }
                
                // Load data from Firebase
                await loadInventoryFromFirebase();
                
                // Set up real-time listeners for inventory changes
                setupRealtimeListeners();
                
            } catch (error) {
                console.error('Error initializing data:', error);
                initializeDemoData();
            }
        }

        // Create real tea inventory
        async function createDemoData() {
            const realTeas = [
                // === CAFFEINATED (17) ===
                { id: 'chai-tea', name: 'Chai Tea', description: 'Traditional Indian spiced tea blend with warming cardamom, cinnamon, and ginger.', price: 3.25, stock: 8, category: 'tea', type: 'caffeinated', origin: 'Indian' },
                { id: 'thai-tea', name: 'Thai Tea', description: 'Bold and vibrant Thai black tea with distinctive orange color and sweet flavor.', price: 3.50, stock: 5, category: 'tea', type: 'caffeinated', origin: 'Thai' },
                { id: 'cinnamon-apple-spice', name: 'Cinnamon Apple Spice', description: 'Cozy American blend with sweet apple pieces and warming cinnamon spices.', price: 3.00, stock: 6, category: 'tea', type: 'caffeinated', origin: 'American' },
                { id: 'royal-blend', name: 'Royal Blend', description: 'Classic British black tea blend, perfect for a proper afternoon tea.', price: 3.75, stock: 7, category: 'tea', type: 'caffeinated', origin: 'British' },
                { id: 'earl-gray', name: 'Earl Gray', description: 'Classic British bergamot-scented black tea, bold and aromatic.', price: 3.25, stock: 6, category: 'tea', type: 'caffeinated', origin: 'British' },
                { id: 'maple-black-tea', name: 'Maple Black Tea', description: 'Rich black tea infused with warm maple sweetness. A comforting autumn-in-a-cup.', price: 3.50, stock: 5, category: 'tea', type: 'caffeinated', origin: 'Canadian' },
                { id: 'green-tea', name: 'Green Tea', description: 'Pure Japanese green tea with fresh, grassy notes and natural antioxidants.', price: 3.25, stock: 9, category: 'tea', type: 'caffeinated', origin: 'Japanese' },
                { id: 'maple-green-tea', name: 'Maple Green Tea', description: 'Delicate green tea kissed with light maple sweetness. Fresh and subtly sweet.', price: 3.50, stock: 5, category: 'tea', type: 'caffeinated', origin: 'Japanese-Canadian' },
                { id: 'high-mountain-dragon-well', name: 'High Mountain Dragon Well', description: 'Premium Chinese green tea with chestnut notes and a smooth, mellow sweetness.', price: 4.50, stock: 4, category: 'tea', type: 'caffeinated', origin: 'Chinese' },
                { id: 'beautys-waist', name: "Beauty's Waist", description: 'Elegant Chinese green tea with a floral aroma and delicate, graceful flavor.', price: 4.00, stock: 4, category: 'tea', type: 'caffeinated', origin: 'Chinese' },
                { id: 'candy-cane-green-tea', name: 'Candy Cane Green Tea', description: 'Festive green tea with cool peppermint and a hint of sweetness.', price: 3.25, stock: 5, category: 'tea', type: 'caffeinated', origin: 'American' },
                { id: 'white-flower-blend', name: 'White Flower Blend', description: 'Fragrant white tea blend with jasmine and chrysanthemum petals.', price: 4.00, stock: 4, category: 'tea', type: 'caffeinated', origin: 'Chinese' },
                { id: 'oolong-tea', name: 'Oolong Tea', description: 'Traditional oolong with complex, semi-oxidized flavor profile.', price: 4.00, stock: 3, category: 'tea', type: 'caffeinated', origin: 'Chinese' },
                { id: 'king-of-hearts', name: 'King of Hearts', description: 'Richly aromatic wulong (oolong) tea with deep, toasty character and smooth finish.', price: 4.25, stock: 3, category: 'tea', type: 'caffeinated', origin: 'Chinese' },
                { id: 'hojicha', name: 'Hojicha', description: 'Roasted Japanese green tea with nutty, caramel-like flavor and lower caffeine.', price: 3.75, stock: 5, category: 'tea', type: 'caffeinated', origin: 'Japanese' },
                { id: 'right-heart', name: 'Right Heart', description: 'Subtle white tea with gentle, pillowy softness and delicate floral whispers.', price: 4.00, stock: 4, category: 'tea', type: 'caffeinated', origin: 'Chinese' },
                { id: 'drinking-chocolate', name: 'Drinking Chocolate', description: 'Rich, velvety European-style drinking chocolate. Indulgent and deeply comforting.', price: 4.50, stock: 5, category: 'tea', type: 'caffeinated', origin: 'European' },
                // === DECAF / HERBAL (13) ===
                { id: 'chamomile', name: 'Chamomile', description: 'Soothing herbal tea with gentle floral notes, perfect for evening relaxation.', price: 2.75, stock: 8, category: 'tea', type: 'decaf', origin: 'American' },
                { id: 'butterfly-pea', name: 'Butterfly Pea', description: 'Magical Thai herbal tea that changes color! Naturally blue, turns purple with lemon.', price: 3.50, stock: 4, category: 'tea', type: 'decaf', origin: 'Thai' },
                { id: 'ssanghwacha', name: 'Ssanghwacha', description: 'Traditional Korean herbal blend with warming properties and earthy flavor.', price: 3.25, stock: 3, category: 'tea', type: 'decaf', origin: 'Korean' },
                { id: 'lemongrass-pandan', name: 'Lemongrass Pandan', description: 'Exotic Thai blend with citrusy lemongrass and sweet, nutty pandan leaf.', price: 3.25, stock: 5, category: 'tea', type: 'decaf', origin: 'Thai' },
                { id: 'lemongrass', name: 'Lemongrass', description: 'Pure Thai lemongrass tea with bright, citrusy flavor and digestive benefits.', price: 2.75, stock: 7, category: 'tea', type: 'decaf', origin: 'Thai' },
                { id: 'corn-silk', name: 'Corn Silk', description: 'Traditional Korean herbal tea known for its subtle sweetness and wellness properties.', price: 2.75, stock: 4, category: 'tea', type: 'decaf', origin: 'Korean' },
                { id: 'ginger-tea', name: 'Ginger Tea', description: 'Warming, spicy ginger root tea that soothes and invigorates.', price: 2.75, stock: 6, category: 'tea', type: 'decaf', origin: 'Asian' },
                { id: 'burdock-root', name: 'Burdock Root', description: 'Earthy, grounding herbal tea with a deep, woodsy flavor and cleansing properties.', price: 3.00, stock: 4, category: 'tea', type: 'decaf', origin: 'Japanese' },
                { id: 'pumpkin-spice-rooibos', name: 'Pumpkin Spice Rooibos', description: 'Caffeine-free South African rooibos with autumn pumpkin spice warmth.', price: 3.25, stock: 5, category: 'tea', type: 'decaf', origin: 'South African' },
                { id: 'wild-sweet-orange', name: 'Wild Sweet Orange', description: 'Bright and uplifting herbal blend bursting with sweet orange citrus.', price: 3.00, stock: 6, category: 'tea', type: 'decaf', origin: 'American' },
                { id: 'jujube-tea', name: 'Jujube Tea', description: 'Traditional Korean red date tea with natural sweetness and calming warmth.', price: 3.25, stock: 4, category: 'tea', type: 'decaf', origin: 'Korean' },
                { id: 'bellflower-root-ginger', name: 'Bellflower Root & Ginger Tea', description: 'Korean herbal blend combining bellflower root with warming ginger.', price: 3.25, stock: 4, category: 'tea', type: 'decaf', origin: 'Korean' },
                { id: 'maple-herbal-tea', name: 'Maple Herbal Tea', description: 'Caffeine-free herbal blend with sweet maple warmth and gentle spice.', price: 3.00, stock: 5, category: 'tea', type: 'decaf', origin: 'Canadian' }
            ];

            const teaAccompaniments = [
                {
                    id: 'local-honey',
                    name: 'Local Honey',
                    description: 'Sweet wildflower honey from local beekeepers. Perfect natural sweetener.',
                    price: 0.50,
                    stock: 15,
                    category: 'accompaniment'
                },
                {
                    id: 'fresh-lemon',
                    name: 'Fresh Lemon',
                    description: 'Bright citrus wedge to enhance your tea and create color-changing magic with Butterfly Pea!',
                    price: 0.25,
                    stock: 12,
                    category: 'accompaniment'
                },
                {
                    id: 'steamed-milk',
                    name: 'Steamed Milk',
                    description: 'Creamy steamed milk, perfect for chai and black teas.',
                    price: 0.75,
                    stock: 8,
                    category: 'accompaniment'
                },
                {
                    id: 'brown-sugar',
                    name: 'Brown Sugar',
                    description: 'Rich brown sugar crystals for a deeper, molasses sweetness.',
                    price: 0.25,
                    stock: 20,
                    category: 'accompaniment'
                },
                {
                    id: 'fresh-ginger',
                    name: 'Fresh Ginger',
                    description: 'Sliced fresh ginger root for an extra warming kick.',
                    price: 0.50,
                    stock: 6,
                    category: 'accompaniment'
                },
                {
                    id: 'homemade-cookies',
                    name: 'Homemade Cookies',
                    description: 'Freshly baked shortbread cookies, perfect tea companions.',
                    price: 1.50,
                    stock: 12,
                    category: 'accompaniment'
                }
            ];

            // Add teas to Firebase
            for (const tea of realTeas) {
                await addDoc(collection(db, 'teas'), tea);
            }

            // Add accompaniments to Firebase
            for (const accompaniment of teaAccompaniments) {
                await addDoc(collection(db, 'accompaniments'), accompaniment);
            }

            console.log('Real tea inventory created in Firebase!');
        }

        // Load inventory from Firebase
        async function loadInventoryFromFirebase() {
            try {
                // Load teas
                const teaSnapshot = await getDocs(collection(db, 'teas'));
                inventory.teas = [];
                teaSnapshot.forEach((doc) => {
                    inventory.teas.push({ firebaseId: doc.id, ...doc.data() });
                });

                // Load accompaniments
                const accompanimentSnapshot = await getDocs(collection(db, 'accompaniments'));
                inventory.accompaniments = [];
                accompanimentSnapshot.forEach((doc) => {
                    inventory.accompaniments.push({ firebaseId: doc.id, ...doc.data() });
                });

                hideLoading();
                renderMenu();
                renderCart();
                
                console.log('Inventory loaded from Firebase:', inventory);
                
            } catch (error) {
                console.error('Error loading inventory:', error);
                showMessage('Error loading inventory from database', 'error');
            }
        }

        // Set up real-time listeners
        function setupRealtimeListeners() {
            // Listen for tea changes
            onSnapshot(collection(db, 'teas'), (snapshot) => {
                inventory.teas = [];
                snapshot.forEach((doc) => {
                    inventory.teas.push({ firebaseId: doc.id, ...doc.data() });
                });
                renderMenu();
            });

            // Listen for accompaniment changes
            onSnapshot(collection(db, 'accompaniments'), (snapshot) => {
                inventory.accompaniments = [];
                snapshot.forEach((doc) => {
                    inventory.accompaniments.push({ firebaseId: doc.id, ...doc.data() });
                });
                renderMenu();
            });
        }

        function hideLoading() {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('main-app').style.display = 'block';
        }

        // Function to render menu items
        function renderMenu() {
            // Separate teas by caffeine content
            const caffeinatedTeas = inventory.teas.filter(tea => tea.type === 'caffeinated');
            const decafTeas = inventory.teas.filter(tea => tea.type === 'decaf');
            
            renderSection('caffeinated-menu', caffeinatedTeas);
            renderSection('decaf-menu', decafTeas);
            renderSection('accompaniments-menu', inventory.accompaniments);
        }

        function renderSection(containerId, items) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';

            items.forEach(item => {
                const itemDiv = document.createElement('div');
                itemDiv.className = `menu-item ${item.stock === 0 ? 'sold-out' : ''}`;
                
                const cartItem = cart.find(c => c.id === item.id);
                const cartQuantity = cartItem ? cartItem.quantity : 0;
                
                itemDiv.innerHTML = `
                    <div class="item-header">
                        <span class="item-name">${item.name}</span>
                        <span class="item-price">${item.price.toFixed(2)}</span>
                    </div>
                    <div class="item-description">${item.description}</div>
                    <div class="item-controls">
                        <div class="stock-info">
                            ${item.stock === 0 ? 
                                '<span class="sold-out-label">OUT OF STOCK</span>' : 
                                '<span style="color: #27ae60; font-weight: bold;">Available</span>'
                            }
                        </div>
                        ${item.stock > 0 ? `
                            <div class="quantity-controls">
                                <button class="qty-btn" onclick="updateCart('${item.id}', -1)" ${cartQuantity === 0 ? 'disabled' : ''}>-</button>
                                <span class="quantity">${cartQuantity}</span>
                                <button class="qty-btn" onclick="updateCart('${item.id}', 1)" ${cartQuantity >= item.stock ? 'disabled' : ''}>+</button>
                            </div>
                        ` : ''}
                    </div>
                `;
                
                container.appendChild(itemDiv);
            });
        }

        // Function to update cart
        window.updateCart = function(itemId, change) {
            // Find the item in inventory
            const item = [...inventory.teas, ...inventory.accompaniments].find(i => i.id === itemId);
            if (!item) return;

            // Find existing cart item
            const cartItemIndex = cart.findIndex(c => c.id === itemId);
            
            if (cartItemIndex >= 0) {
                // Update existing cart item
                cart[cartItemIndex].quantity += change;
                if (cart[cartItemIndex].quantity <= 0) {
                    cart.splice(cartItemIndex, 1);
                }
            } else if (change > 0) {
                // Add new item to cart
                cart.push({
                    id: itemId,
                    name: item.name,
                    price: item.price,
                    quantity: change
                });
            }

            renderMenu();
            renderCart();
        }

        // Function to render cart
        function renderCart() {
            const cartContainer = document.getElementById('cart-items');
            const cartTotal = document.getElementById('cart-total');
            const submitBtn = document.getElementById('submit-order');

            if (cart.length === 0) {
                cartContainer.innerHTML = '<div class="empty-cart">Your cart is empty</div>';
                cartTotal.textContent = 'Total: $0.00';
                submitBtn.disabled = true;
                return;
            }

            cartContainer.innerHTML = '';
            let total = 0;

            cart.forEach(item => {
                const cartItemDiv = document.createElement('div');
                cartItemDiv.className = 'cart-item';
                
                const itemTotal = item.price * item.quantity;
                total += itemTotal;
                
                cartItemDiv.innerHTML = `
                    <span>${item.name} √ó ${item.quantity}</span>
                    <span>$${itemTotal.toFixed(2)}</span>
                `;
                
                cartContainer.appendChild(cartItemDiv);
            });

            cartTotal.textContent = `Total: $${total.toFixed(2)}`;
            submitBtn.disabled = false;
        }



        // Function to handle order submission
        document.getElementById('order-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const customerName = document.getElementById('customer-name').value;
            const specialRequests = document.getElementById('special-requests').value;
            
            // Create the order object
            const order = {
                id: Date.now(),
                customer: customerName,
                items: [...cart],
                specialRequests: specialRequests,
                total: cart.reduce((sum, item) => sum + (item.price * item.quantity), 0),
                timestamp: new Date().toISOString(),
                status: 'placed'
            };

            try {
                // Save order to Firebase
                if (db) {
                    await addDoc(collection(db, 'orders'), order);
                }

                // Update inventory (subtract ordered quantities)
                for (const cartItem of cart) {
                    let item = inventory.teas.find(t => t.id === cartItem.id);
                    let collection_name = 'teas';
                    
                    if (!item) {
                        item = inventory.accompaniments.find(a => a.id === cartItem.id);
                        collection_name = 'accompaniments';
                    }
                    
                    if (item) {
                        const newStock = item.stock - cartItem.quantity;
                        
                        if (db && item.firebaseId) {
                            // Update in Firebase
                            await updateDoc(doc(db, collection_name, item.firebaseId), {
                                stock: newStock
                            });
                        } else {
                            // Update locally for demo mode
                            item.stock = newStock;
                        }
                    }
                }

                // Clear cart and reset form
                cart = [];
                this.reset();
                
                // Update display
                renderMenu();
                renderCart();
                
                // Show success message
                showMessage(`Thank you ${customerName}! Your order has been placed. Total: $${order.total.toFixed(2)}`, 'success');
                
                console.log('Order placed:', order);
                
            } catch (error) {
                console.error('Error placing order:', error);
                showMessage('Error placing order. Please try again.', 'error');
            }
        });

        // Function to show messages
        function showMessage(text, type) {
            const messageArea = document.getElementById('message-area');
            messageArea.innerHTML = `<div class="message ${type}">${text}</div>`;
            
            setTimeout(() => {
                messageArea.innerHTML = '';
            }, 5000);
        }

        // ===== FIND YOUR TEA-MATE QUIZ =====
        let quizAnswers = [null, null, null, null];
        const TOTAL_STEPS = 4;

        // Tea profiles: caffeine, mood, flavor, personality
        const teaProfiles = {
            // === CAFFEINATED (17) ===
            'chai-tea':                  { caffeine: 'caffeinated', mood: 'cozy',    flavor: 'spicy', personality: 'bold',    compat: 94, bio: "The friend who always brings the best snacks. Warm, bold, and down for anything.", traits: ['Warming', 'Spiced', 'Bold'], origin: 'Indian classic' },
            'thai-tea':                  { caffeine: 'caffeinated', mood: 'exotic',  flavor: 'sweet', personality: 'bold',    compat: 92, bio: "Life of the party ‚Äî bright, fun, and always brings the energy.", traits: ['Vibrant', 'Creamy', 'Exotic'], origin: 'Thai street favorite' },
            'cinnamon-apple-spice':      { caffeine: 'caffeinated', mood: 'cozy',    flavor: 'sweet', personality: 'classic', compat: 90, bio: "Your cozy movie marathon partner. Brings blankets and good vibes.", traits: ['Autumnal', 'Sweet', 'Comforting'], origin: 'American cozy' },
            'royal-blend':               { caffeine: 'caffeinated', mood: 'classy',  flavor: 'deep',  personality: 'classic', compat: 93, bio: "The friend with impeccable taste who introduces you to the finer things.", traits: ['Regal', 'Smooth', 'Timeless'], origin: 'British classic' },
            'earl-gray':                 { caffeine: 'caffeinated', mood: 'classy',  flavor: 'fresh', personality: 'classic', compat: 91, bio: "Effortlessly cool, always reliable. The friend who somehow has their life together.", traits: ['Aromatic', 'Citrusy', 'Refined'], origin: 'British bergamot' },
            'maple-black-tea':           { caffeine: 'caffeinated', mood: 'cozy',    flavor: 'sweet', personality: 'gentle',  compat: 89, bio: "Sweet and dependable ‚Äî the one who remembers your birthday every year.", traits: ['Maple', 'Rich', 'Comforting'], origin: 'Canadian warmth' },
            'green-tea':                 { caffeine: 'caffeinated', mood: 'peaceful', flavor: 'fresh', personality: 'gentle', compat: 88, bio: "Your chill workout buddy. Keeps it simple, keeps it real.", traits: ['Fresh', 'Clean', 'Zen'], origin: 'Japanese pure' },
            'maple-green-tea':           { caffeine: 'caffeinated', mood: 'peaceful', flavor: 'sweet', personality: 'gentle', compat: 87, bio: "Easygoing with a sweet side. Perfect study buddy energy.", traits: ['Subtle', 'Sweet', 'Gentle'], origin: 'Japanese-Canadian fusion' },
            'high-mountain-dragon-well': { caffeine: 'caffeinated', mood: 'classy',  flavor: 'deep',  personality: 'unique', compat: 96, bio: "The worldly friend who always has the best stories and advice.", traits: ['Premium', 'Nutty', 'Complex'], origin: 'Chinese highland' },
            'beautys-waist':             { caffeine: 'caffeinated', mood: 'classy',  flavor: 'fresh', personality: 'gentle', compat: 92, bio: "Graceful and thoughtful ‚Äî the friend who writes you handwritten notes.", traits: ['Floral', 'Elegant', 'Graceful'], origin: 'Chinese artisan' },
            'candy-cane-green-tea':      { caffeine: 'caffeinated', mood: 'cozy',    flavor: 'fresh', personality: 'bold',   compat: 86, bio: "The fun one who makes every hangout feel like a celebration.", traits: ['Minty', 'Festive', 'Playful'], origin: 'American holiday' },
            'white-flower-blend':        { caffeine: 'caffeinated', mood: 'peaceful', flavor: 'sweet', personality: 'unique', compat: 93, bio: "Quiet and elegant ‚Äî the friend who makes you feel calm just being around them.", traits: ['Floral', 'Ethereal', 'Rare'], origin: 'Chinese garden' },
            'oolong-tea':                { caffeine: 'caffeinated', mood: 'classy',  flavor: 'deep',  personality: 'bold',   compat: 91, bio: "Complex and fascinating. Every conversation reveals something new.", traits: ['Complex', 'Layered', 'Intriguing'], origin: 'Chinese traditional' },
            'king-of-hearts':            { caffeine: 'caffeinated', mood: 'exotic',  flavor: 'deep',  personality: 'unique', compat: 95, bio: "Bold personality, warm heart. The friend everyone wants at their table.", traits: ['Toasty', 'Regal', 'Aromatic'], origin: 'Chinese wulong' },
            'hojicha':                   { caffeine: 'balanced',    mood: 'cozy',    flavor: 'deep',  personality: 'unique', compat: 90, bio: "Laid-back and interesting. The cozy friend who always surprises you.", traits: ['Roasted', 'Nutty', 'Mellow'], origin: 'Japanese roasted' },
            'right-heart':               { caffeine: 'caffeinated', mood: 'peaceful', flavor: 'sweet', personality: 'classic', compat: 91, bio: "Gentle and thoughtful ‚Äî the friend who really listens.", traits: ['Delicate', 'Soft', 'Serene'], origin: 'Chinese white tea' },
            'drinking-chocolate':        { caffeine: 'caffeinated', mood: 'exotic',  flavor: 'sweet', personality: 'gentle', compat: 94, bio: "Rich, indulgent, and unapologetically extra. The friend who goes all out.", traits: ['Velvety', 'Indulgent', 'Rich'], origin: 'European luxury' },

            // === DECAF / HERBAL (13) ===
            'chamomile':                 { caffeine: 'decaf', mood: 'peaceful', flavor: 'sweet', personality: 'classic', compat: 89, bio: "Your calm-down buddy. Always knows the right thing to say.", traits: ['Soothing', 'Floral', 'Golden'], origin: 'American herbal' },
            'butterfly-pea':             { caffeine: 'decaf', mood: 'exotic',  flavor: 'sweet', personality: 'unique', compat: 95, bio: "The wildcard friend who makes ordinary hangouts magical. Just add lemon.", traits: ['Magical', 'Color-changing', 'Enchanting'], origin: 'Thai mystical' },
            'ssanghwacha':               { caffeine: 'decaf', mood: 'cozy',    flavor: 'deep',  personality: 'unique', compat: 90, bio: "Old soul energy. The wise friend who gives the best advice.", traits: ['Medicinal', 'Earthy', 'Traditional'], origin: 'Korean heritage' },
            'lemongrass-pandan':         { caffeine: 'decaf', mood: 'exotic',  flavor: 'fresh', personality: 'gentle', compat: 88, bio: "The adventurous friend who introduces you to amazing new things.", traits: ['Tropical', 'Citrusy', 'Aromatic'], origin: 'Thai tropical' },
            'lemongrass':                { caffeine: 'decaf', mood: 'peaceful', flavor: 'fresh', personality: 'gentle', compat: 86, bio: "Refreshingly honest and low-maintenance. No drama, just good times.", traits: ['Bright', 'Citrusy', 'Clean'], origin: 'Thai herbal' },
            'corn-silk':                 { caffeine: 'decaf', mood: 'peaceful', flavor: 'sweet', personality: 'unique', compat: 87, bio: "Underrated and surprising. The quiet friend who's secretly the funniest.", traits: ['Subtle', 'Sweet', 'Unexpected'], origin: 'Korean wellness' },
            'ginger-tea':                { caffeine: 'decaf', mood: 'cozy',    flavor: 'spicy', personality: 'bold',   compat: 91, bio: "Fiery and upfront ‚Äî the friend who always tells it like it is.", traits: ['Warming', 'Spicy', 'Invigorating'], origin: 'Asian tradition' },
            'burdock-root':              { caffeine: 'decaf', mood: 'peaceful', flavor: 'deep',  personality: 'unique', compat: 88, bio: "Grounded and steady. The friend who keeps you centered.", traits: ['Earthy', 'Woodsy', 'Grounding'], origin: 'Japanese herbal' },
            'pumpkin-spice-rooibos':     { caffeine: 'decaf', mood: 'cozy',    flavor: 'sweet', personality: 'classic', compat: 90, bio: "Cozy hangout energy. Brings the fall vibes all year round.", traits: ['Autumnal', 'Spiced', 'Caffeine-free'], origin: 'South African blend' },
            'wild-sweet-orange':         { caffeine: 'decaf', mood: 'exotic',  flavor: 'fresh', personality: 'bold',   compat: 89, bio: "Bright and uplifting ‚Äî the friend who always cheers you up.", traits: ['Citrus', 'Bright', 'Energizing'], origin: 'American herbal' },
            'jujube-tea':                { caffeine: 'decaf', mood: 'cozy',    flavor: 'sweet', personality: 'gentle', compat: 91, bio: "Sweet and nurturing. The friend who makes sure everyone's taken care of.", traits: ['Sweet', 'Calming', 'Nourishing'], origin: 'Korean traditional' },
            'bellflower-root-ginger':    { caffeine: 'decaf', mood: 'cozy',    flavor: 'spicy', personality: 'classic', compat: 88, bio: "Reliable with a little kick. The friend who pushes you to be better.", traits: ['Herbal', 'Warming', 'Traditional'], origin: 'Korean medicinal' },
            'maple-herbal-tea':          { caffeine: 'decaf', mood: 'peaceful', flavor: 'sweet', personality: 'gentle', compat: 87, bio: "Gentle and sweet. The low-key friend who's always down to chill.", traits: ['Maple', 'Gentle', 'Caffeine-free'], origin: 'Canadian herbal' }
        };

        window.startQuiz = function(e) {
            e.stopPropagation();
            const callout = document.getElementById('teammate-callout');
            if (!callout.classList.contains('expanded')) {
                callout.classList.add('expanded');
            }
        };

        window.closeQuiz = function(e) {
            e.stopPropagation();
            const callout = document.getElementById('teammate-callout');
            callout.classList.remove('expanded');
            resetQuiz();
        };

        function resetQuiz() {
            quizAnswers = [null, null, null, null];
            for (let i = 0; i < TOTAL_STEPS; i++) {
                document.getElementById(`step-${i}`).classList.remove('active');
                document.getElementById(`dot-${i}`).classList.remove('active', 'completed');
            }
            document.getElementById('step-0').classList.add('active');
            document.getElementById('dot-0').classList.add('active');
            document.getElementById('quiz-reveal').classList.remove('active');
            document.querySelectorAll('.quiz-option').forEach(o => o.classList.remove('selected'));
        }

        window.selectOption = function(e, step, value) {
            e.stopPropagation();
            quizAnswers[step] = value;

            // Highlight selected
            const stepEl = document.getElementById(`step-${step}`);
            stepEl.querySelectorAll('.quiz-option').forEach(o => o.classList.remove('selected'));
            e.currentTarget.classList.add('selected');

            // Advance after short delay
            setTimeout(() => {
                document.getElementById(`dot-${step}`).classList.remove('active');
                document.getElementById(`dot-${step}`).classList.add('completed');
                document.getElementById(`step-${step}`).classList.remove('active');

                if (step < TOTAL_STEPS - 1) {
                    document.getElementById(`step-${step + 1}`).classList.add('active');
                    document.getElementById(`dot-${step + 1}`).classList.add('active');
                } else {
                    showReveal();
                }
            }, 400);
        };

        window.retryQuiz = function(e) {
            e.stopPropagation();
            resetQuiz();
        };

        function findTeaMatch() {
            const [cafPref, moodPref, flavorPref, personalityPref] = quizAnswers;
            const allItems = [...inventory.teas, ...inventory.accompaniments];
            let bestMatch = null;
            let bestScore = -1;

            for (const [teaId, profile] of Object.entries(teaProfiles)) {
                // Check if in stock
                const invItem = allItems.find(i => i.id === teaId);
                if (invItem && invItem.stock <= 0) continue;

                let score = 0;

                // Caffeine match (weight 3)
                if (cafPref === 'adventurous') {
                    score += 2; // all teas are fair game
                } else if (cafPref === 'balanced') {
                    if (profile.caffeine === 'balanced') score += 4;
                    else score += 1;
                } else if (profile.caffeine === cafPref) {
                    score += 3;
                }

                // Mood match (weight 2)
                if (profile.mood === moodPref) score += 2;

                // Flavor match (weight 2)
                if (profile.flavor === flavorPref) score += 2;

                // Personality match (weight 2)
                if (profile.personality === personalityPref) score += 2;

                // Tiny random factor for variety on retakes
                score += Math.random() * 0.5;

                if (score > bestScore) {
                    bestScore = score;
                    bestMatch = teaId;
                }
            }

            return bestMatch || 'chamomile';
        }

        function showReveal() {
            const teaId = findTeaMatch();
            const profile = teaProfiles[teaId];
            const allItems = [...inventory.teas, ...inventory.accompaniments];
            const invItem = allItems.find(i => i.id === teaId);

            document.getElementById('match-name').textContent = invItem ? invItem.name : teaId;
            document.getElementById('match-origin').textContent = profile.origin;
            document.getElementById('match-bio').textContent = `"${profile.bio}"`;
            document.getElementById('match-price').textContent = invItem ? `$${invItem.price.toFixed(2)}` : '';

            // Tea image
            const imgContainer = document.getElementById('match-image-container');
            imgContainer.innerHTML = `<img class="match-image" src="./images/quiz/${teaId}.jpg" alt="${invItem ? invItem.name : teaId}" onerror="this.outerHTML='<div class=\\'match-image-placeholder\\'>üçµ</div>'">`;

            // Traits
            const traitsEl = document.getElementById('match-traits');
            traitsEl.innerHTML = profile.traits.map(t => `<span class="trait-tag">${t}</span>`).join('');

            // Compatibility bar
            const fill = document.getElementById('compat-fill');
            const pct = document.getElementById('compat-percent');
            fill.style.width = '0%';
            pct.textContent = `${profile.compat}%`;

            // Add to cart button
            const addBtn = document.getElementById('match-add-btn');
            addBtn.onclick = function(e) {
                e.stopPropagation();
                if (typeof updateCart === 'function' && invItem) {
                    updateCart(teaId, 1);
                    addBtn.textContent = '‚úì Added!';
                    addBtn.style.background = 'linear-gradient(135deg, #2d6a30, #3a8a3e)';
                    setTimeout(() => {
                        addBtn.textContent = '‚òï Add to Order';
                        addBtn.style.background = '';
                    }, 2000);
                }
            };

            // Show reveal
            document.getElementById('quiz-reveal').classList.add('active');
            launchHearts();

            // Animate compatibility bar
            setTimeout(() => { fill.style.width = profile.compat + '%'; }, 300);
        }

        function launchHearts() {
            const container = document.getElementById('floating-hearts');
            container.innerHTML = '';
            const hearts = ['‚ú®', '‚≠ê', 'üåü', '‚òï', 'üçµ'];
            for (let i = 0; i < 12; i++) {
                const heart = document.createElement('span');
                heart.className = 'float-heart';
                heart.textContent = hearts[Math.floor(Math.random() * hearts.length)];
                heart.style.left = Math.random() * 100 + '%';
                heart.style.animationDelay = Math.random() * 2 + 's';
                heart.style.fontSize = (0.8 + Math.random() * 0.8) + 'em';
                container.appendChild(heart);
            }
        }

        // Make functions available globally
        window.showMessage = showMessage;
    </script>
</body>
</html>
